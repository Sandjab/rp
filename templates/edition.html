<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>{{EDITION_TITLE}} — {{EDITION_DATE}}</title>
<meta name="description" content="Revue de presse quotidienne IA — Modeles, Produits, Business, Recherche, Societe, Marches">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#FAFAF8;--card:#FFFFFF;--text:#1A1A1A;--text-2:#6B6B6B;
  --accent:#E63946;--border:#E5E5E3;
  --font-h:'Instrument Serif',serif;--font-b:'Inter',sans-serif;--font-m:'JetBrains Mono',monospace;
  --ease:cubic-bezier(0.25,0.46,0.45,0.94);
  --spring:cubic-bezier(0.34,1.56,0.64,1);
  --spring-back:cubic-bezier(0.25,1.2,0.5,1);
}
[data-theme="dark"]{
  --bg:#0F0F0F;--card:#1A1A1A;--text:#EDEDEB;--text-2:#999999;
  --accent:#FF6B6B;--border:#2A2A2A;
}
html{font-size:16px;-webkit-text-size-adjust:100%}
body{
  font-family:var(--font-b);color:var(--text);background:var(--bg);
  height:100dvh;transition:background .3s var(--ease),color .3s var(--ease);
  overflow:hidden;
  display:flex;flex-direction:column;
}
a{color:inherit;text-decoration:none}

/* MASTHEAD */
.masthead{
  padding:clamp(1rem,2vw,2rem) clamp(1rem,5vw,4rem);
  border-bottom:2px solid var(--text);
  display:flex;justify-content:space-between;align-items:baseline;
  flex-wrap:wrap;gap:0.5rem;
  flex-shrink:0;
}
.masthead h1{
  font-family:var(--font-h);font-size:clamp(2.5rem,6vw,4rem);
  font-weight:700;letter-spacing:-0.02em;line-height:1;
}
.masthead-subtitle{
  font-family:var(--font-b);font-size:clamp(0.8rem,1.5vw,1rem);
  color:var(--text-2);margin-top:0.2rem;font-weight:400;
}
.masthead-meta{
  font-family:var(--font-m);font-size:clamp(0.7rem,1.2vw,0.85rem);
  color:var(--text-2);display:flex;align-items:center;gap:1.5rem;
}
.masthead-right{display:flex;flex-direction:column;align-items:flex-end;gap:0.3rem;margin-left:auto}
.hit-counter{height:20px;opacity:0.7;transition:opacity .2s}
.hit-counter:hover{opacity:1}
.masthead-nav{display:flex;align-items:center;gap:0.5rem}
.masthead-btn{
  background:none;border:1px solid var(--border);color:var(--text-2);
  padding:0.4rem;cursor:pointer;transition:all .2s;
  display:inline-flex;align-items:center;justify-content:center;
  text-decoration:none;
}
.masthead-btn:hover{border-color:var(--text);color:var(--text)}
.masthead-btn svg{width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round}

/* BREAKING */
.breaking{
  background:var(--accent);color:#fff;
  padding:0.8rem clamp(1rem,5vw,4rem);
  font-family:var(--font-m);font-size:0.85rem;
  display:none;align-items:center;gap:0.8rem;
  flex-shrink:0;
}
.breaking.active{display:flex}
.breaking-dot{
  width:8px;height:8px;border-radius:50%;background:#fff;
  animation:pulse 2s infinite;flex-shrink:0;
}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}

/* CARD CONTAINER */
.card-viewport{
  position:relative;
  padding:clamp(1rem,2vw,2rem) clamp(1rem,5vw,4rem);
  flex:1;overflow:hidden;
  display:flex;flex-direction:column;
}
.card-stack{position:relative;max-width:720px;margin:0 auto;flex:1;width:100%}
.card{
  position:absolute;top:0;left:0;right:0;bottom:0;
  background:var(--card);border:1px solid var(--border);
  padding:clamp(1.5rem,3vw,2.5rem);
  opacity:0;pointer-events:none;
  transition:transform .4s var(--ease),opacity .35s ease-out;
  touch-action:pan-y pinch-zoom;user-select:none;
  will-change:transform,opacity;
  overflow-y:auto;-webkit-overflow-scrolling:touch;
}
.card.active{
  opacity:1;pointer-events:auto;
  transform:translateX(0);
}
.card.enter-left{transform:translateX(-100%);opacity:0}
.card.enter-right{transform:translateX(100%);opacity:0}
.card.exit-left{transform:translateX(-100%);opacity:0}
.card.exit-right{transform:translateX(100%);opacity:0}
/* Synthesis card */
.card.synthesis-card{
  border-left:4px solid var(--accent);
  background:var(--card);
  background:color-mix(in srgb,var(--accent) 4%,var(--card));
}
.synth-tag{
  font-family:var(--font-m);font-size:0.6rem;
  text-transform:uppercase;letter-spacing:0.12em;
  background:var(--accent);color:#fff;
  padding:0.2rem 0.6rem;display:inline-block;margin-bottom:1rem;
}
.card.synthesis-card .card-summary{font-size:clamp(0.85rem,1.3vw,0.95rem)}
.grid-card.synthesis-grid{grid-column:1/-1}
.grid-card.synthesis-grid .card-summary{
  -webkit-line-clamp:unset;-webkit-box-orient:initial;overflow:visible;display:block;
}

/* CARD CONTENT */
.card-tags{display:flex;gap:0.5rem;margin-bottom:1.2rem;flex-wrap:wrap}
.tag-pill{
  font-family:var(--font-m);font-size:0.65rem;
  padding:0.25rem 0.6rem;text-transform:uppercase;
  letter-spacing:0.08em;transition:opacity .2s;
}
.tag-pill:hover{opacity:1!important}
.card-title{
  font-family:var(--font-h);font-size:clamp(1.5rem,3.5vw,2.2rem);
  font-weight:400;line-height:1.2;margin-bottom:0.8rem;
  letter-spacing:-0.01em;
}
.card-source{
  font-family:var(--font-m);font-size:0.75rem;color:var(--text-2);
  margin-bottom:1.2rem;text-transform:uppercase;letter-spacing:0.05em;
}
.card-summary{
  font-size:clamp(0.95rem,1.5vw,1.05rem);line-height:1.7;
  color:var(--text);margin-bottom:1.5rem;
}
.edito-signature{display:block;text-align:right;margin-top:1rem;font-style:italic}
.card-context{
  overflow:hidden;max-height:0;transition:max-height .4s var(--ease);
  margin-bottom:1rem;
}
.card-context.open{max-height:500px}
.card-context-inner{
  padding:1rem;background:var(--bg);border-left:3px solid var(--accent);
  font-size:0.9rem;line-height:1.7;color:var(--text-2);margin-bottom:1rem;
}
.context-toggle{
  font-family:var(--font-m);font-size:0.75rem;color:var(--accent);
  background:none;border:none;cursor:pointer;
  display:flex;align-items:center;gap:0.4rem;margin-bottom:1.2rem;
}
.context-toggle .arrow{
  display:inline-block;transition:transform .3s;font-size:0.6rem;
}
.context-toggle.open .arrow{transform:rotate(90deg)}
.card-link{
  font-family:var(--font-m);font-size:0.8rem;
  color:var(--accent);display:inline-flex;align-items:center;gap:0.4rem;
  transition:gap .2s;
}
.card-link:hover{gap:0.8rem}

/* NAVIGATION */
.card-nav{
  display:flex;justify-content:center;align-items:center;
  gap:1.5rem;padding:0.8rem 0;max-width:720px;margin:0 auto;
  flex-shrink:0;
}
.nav-btn{
  background:none;border:1px solid var(--border);
  color:var(--text);width:40px;height:40px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;transition:border-color .2s;font-size:1.2rem;
}
.nav-btn:hover{border-color:var(--text)}
.nav-btn:disabled{opacity:0.3;cursor:default}
.card-counter{
  font-family:var(--font-m);font-size:0.85rem;color:var(--text-2);
  min-width:60px;text-align:center;
  position:relative;overflow:hidden;height:1.2em;
}
.counter-num{
  display:inline-block;transition:transform .3s var(--ease);
}
.dots{display:flex;gap:6px;align-items:center}
.dot{
  width:6px;height:6px;border-radius:50%;background:var(--border);
  cursor:pointer;transition:all .25s var(--ease);
}
.dot.active{
  width:10px;height:10px;background:var(--accent);
}

/* GRID VIEW */
.grid-view{
  display:none;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:1.5rem;padding:clamp(1.5rem,4vw,3rem) clamp(1rem,5vw,4rem);
  max-width:1200px;margin:0 auto;
}
.grid-view.active{display:grid}
.grid-card{
  background:var(--card);border:1px solid var(--border);
  padding:1.5rem;transition:border-color .2s;cursor:pointer;
}
.grid-card:hover{border-color:var(--text)}
.grid-card .card-title{font-size:clamp(1.1rem,2vw,1.4rem)}
.grid-card .card-summary{
  font-size:0.9rem;line-height:1.6;
  display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;
}
.grid-card .grid-card-extra{display:none;margin-top:1rem}
.grid-card.expanded .card-summary{
  -webkit-line-clamp:unset;-webkit-box-orient:initial;overflow:visible;display:block;
}
.grid-card.expanded .grid-card-extra{display:block}
.grid-card.expanded{border-color:var(--accent)}

/* FOOTER */
.edition-footer{
  border-top:2px solid var(--text);
  padding:clamp(1.5rem,4vw,2rem) clamp(1rem,5vw,4rem);
  display:none;justify-content:space-between;align-items:center;
  flex-wrap:wrap;gap:1rem;
  font-family:var(--font-m);font-size:0.75rem;color:var(--text-2);
  flex-shrink:0;
}
.footer-nav{display:flex;gap:1.5rem}
.footer-nav a{transition:color .2s}
.footer-nav a:hover{color:var(--text)}

/* REDUCED MOTION */
@media(prefers-reduced-motion:reduce){
  *,*::before,*::after{
    animation-duration:0.01ms!important;animation-iteration-count:1!important;
    transition-duration:0.01ms!important;
  }
}

/* MOBILE */
@media(max-width:640px){
  .masthead{flex-direction:column;gap:0.3rem;padding:0.6rem 1rem}
  .masthead h1{font-size:clamp(1.8rem,6vw,2.5rem)}
  .masthead-meta{gap:0.6rem;flex-wrap:wrap;font-size:0.65rem;width:100%}
  .card{padding:1rem}
  .card-viewport{padding:0.5rem 0.8rem}
  .card-title{font-size:clamp(1.2rem,4.5vw,1.6rem)}
  .card-summary{font-size:0.9rem;line-height:1.55}
  .nav-btn{display:none}
  .card-nav{gap:0.8rem;padding:0.5rem 0}
  .card-counter{display:none}
  .dots{gap:4px}
  .dot{width:5px;height:5px}
  .dot.active{width:8px;height:8px}
  .card-link{font-size:0.85rem;padding:0.4rem 0;min-height:44px;display:inline-flex;align-items:center}
  .grid-view{grid-template-columns:1fr}
  .grid-card{padding:1.2rem}
  .context-toggle{padding:0.2rem 0;font-size:0.75rem}
  .hit-counter{height:16px}
  .breaking{font-size:0.75rem;padding:0.5rem 1rem}
  .card.synthesis-card{padding:1rem 0.8rem;border-left-width:3px}
  .card-source{margin-bottom:0.8rem;font-size:0.7rem}
  .card-tags{margin-bottom:0.8rem}
  .card-context-inner{padding:0.8rem;font-size:0.85rem}
}
</style>
</head>
<body>

<header class="masthead">
  <div class="masthead-titles">
    <h1><a href="https://sandjab.github.io/rp/" style="color:inherit;text-decoration:none">{{EDITION_TITLE}}</a></h1>
    <p class="masthead-subtitle">l'actu IA du jour, avec les croissants</p>
  </div>
  <div class="masthead-meta">
    <span>{{EDITION_DATE_DISPLAY}}</span>
    <span>No. {{EDITION_NUMBER}}</span>
    <div class="masthead-right">
      <img class="hit-counter" src="https://hitscounter.dev/api/hit?url=sandjab.github.io%2Frp&label=Visiteurs&icon=eye&color=%23dc3545&message=&style=social&tz=localtime" alt="Visiteurs">
      <nav class="masthead-nav">
        <a class="masthead-btn" href="https://sandjab.github.io/rp/" aria-label="Accueil">
          <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        </a>
        <button class="masthead-btn" onclick="goHome()" aria-label="Edito">
          <svg viewBox="0 0 24 24"><path d="M4 22h16a2 2 0 002-2V4a2 2 0 00-2-2H8a2 2 0 00-2 2v16a2 2 0 01-2 2zm0 0a2 2 0 01-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8M18 18h-8M18 10h-8"/></svg>
        </button>
        {{MASTHEAD_NAV}}
        <button class="masthead-btn view-toggle" onclick="toggleView()" aria-label="Basculer la vue">
          <svg class="icon-grid" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          <svg class="icon-cards" style="display:none" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="18" rx="2"/><path d="M2 9h20"/></svg>
        </button>
        <button class="masthead-btn theme-toggle" onclick="toggleTheme()" aria-label="Basculer le theme">
          <svg class="icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
          <svg class="icon-moon" style="display:none" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
        </button>
      </nav>
    </div>
  </div>
</header>

<div class="breaking" id="breaking">
  <span class="breaking-dot"></span>
  <span id="breaking-text"></span>
</div>

<section class="card-viewport" id="cardViewport">
  <div class="card-stack" id="cardStack">
    {{CARDS}}
  </div>
  <nav class="card-nav" id="cardNav">
    <button class="nav-btn" id="prevBtn" onclick="navigate(-1)" aria-label="Precedent">&#8592;</button>
    <div class="card-counter"><span class="counter-num" id="counterNum">1</span> / <span id="totalNum">0</span></div>
    <div class="dots" id="dots"></div>
    <button class="nav-btn" id="nextBtn" onclick="navigate(1)" aria-label="Suivant">&#8594;</button>
  </nav>
</section>

<section class="grid-view" id="gridView">
  {{GRID_CARDS}}
</section>

<footer class="edition-footer">
  <span>Genere par Claude — {{GENERATION_TIME}}</span>
  <nav class="footer-nav">
    {{FOOTER_NAV}}
  </nav>
</footer>

<script>
(function(){
  "use strict";

  const articles = {{ARTICLES_JSON}};

  // State
  let current = 0;
  let filtered = articles.map((_,i) => i);
  let isGrid = false;
  let startX = 0;
  let deltaX = 0;
  let isDragging = false;
  let isAnimating = false;

  const stack = document.getElementById('cardStack');
  const viewport = document.getElementById('cardViewport');
  const cardNav = document.getElementById('cardNav');
  const gridView = document.getElementById('gridView');
  const counterNum = document.getElementById('counterNum');
  const totalNum = document.getElementById('totalNum');
  const dotsEl = document.getElementById('dots');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  // Theme
  function initTheme(){
    const saved = localStorage.getItem('rp-theme');
    const prefer = window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light';
    const theme = saved || prefer;
    document.documentElement.setAttribute('data-theme', theme);
    updateToggleLabel(theme);
  }
  window.toggleTheme = function(){
    const cur = document.documentElement.getAttribute('data-theme');
    const next = cur === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('rp-theme', next);
    updateToggleLabel(next);
  };
  function updateToggleLabel(theme){
    const tb = document.querySelector('.theme-toggle');
    tb.querySelector('.icon-sun').style.display = theme === 'dark' ? 'none' : '';
    tb.querySelector('.icon-moon').style.display = theme === 'dark' ? '' : 'none';
  }

  // Breaking news
  const breaking = articles.find(a => a.is_breaking);
  if(breaking){
    document.getElementById('breaking').classList.add('active');
    document.getElementById('breaking-text').textContent = breaking.title;
  }

  // Navigation helper
  function updateNav(){
    counterNum.textContent = current + 1;
    totalNum.textContent = filtered.length;
    prevBtn.disabled = current === 0;
    nextBtn.disabled = current >= filtered.length - 1;
    updateDots();
  }

  // Cards — direct show (no animation, used for init and filter reset)
  function showCard(idx){
    if(filtered.length === 0) return;
    isAnimating = false;
    current = Math.max(0, Math.min(idx, filtered.length - 1));
    const cards = stack.querySelectorAll('.card');
    cards.forEach(c => {
      c.classList.remove('active','exit-left','exit-right','enter-left','enter-right');
      c.style.transform = '';
      c.style.transition = '';
      c.style.opacity = '';
    });
    const activeCard = stack.querySelector(`[data-index="${filtered[current]}"]`);
    if(activeCard) activeCard.classList.add('active');
    updateNav();
  }

  // Navigate with bidirectional slide+fade spring transitions
  window.navigate = function(dir){
    if(filtered.length === 0 || isAnimating) return;
    const next = current + dir;
    if(next < 0 || next >= filtered.length) return;

    isAnimating = true;

    const prevCard = stack.querySelector(`[data-index="${filtered[current]}"]`);
    const nextCard = stack.querySelector(`[data-index="${filtered[next]}"]`);
    if(!prevCard || !nextCard){ isAnimating = false; return; }

    // Clear any residual inline styles from swipe drag
    prevCard.style.transform = '';
    prevCard.style.opacity = '';
    prevCard.style.transition = '';

    // Exit current card
    prevCard.classList.remove('active');
    prevCard.classList.add(dir > 0 ? 'exit-left' : 'exit-right');

    // Position next card off-screen without transition
    nextCard.classList.add(dir > 0 ? 'enter-right' : 'enter-left');
    nextCard.style.transition = 'none';
    nextCard.offsetHeight; // force reflow
    nextCard.style.transition = '';

    // Animate entry
    nextCard.classList.remove('enter-left','enter-right');
    nextCard.classList.add('active');

    current = next;
    updateNav();

    // Cleanup
    setTimeout(() => {
      prevCard.classList.remove('exit-left','exit-right');
      isAnimating = false;
    }, 600);
  };

  // Swipe — pointer events with spring physics
  let activePointerId = null;
  const swipeThreshold = () => Math.min(80, window.innerWidth * 0.2);

  let startY = 0;
  let swipeLocked = false; // once direction is determined, lock it

  function onPointerDown(e){
    if(isGrid || isAnimating) return;
    const card = e.target.closest('.card.active');
    if(!card) return;
    if(activePointerId !== null) return;
    activePointerId = e.pointerId;
    isDragging = true;
    swipeLocked = false;
    startX = e.clientX;
    startY = e.clientY;
    deltaX = 0;
  }
  function onPointerMove(e){
    if(!isDragging || e.pointerId !== activePointerId) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;

    // Determine direction on first significant move
    if(!swipeLocked && (Math.abs(dx) > 12 || Math.abs(dy) > 12)){
      if(Math.abs(dy) > Math.abs(dx) * 0.7){
        // Vertical scroll — abort swipe, let native scroll handle it
        isDragging = false;
        activePointerId = null;
        return;
      }
      // Horizontal swipe — lock and capture
      swipeLocked = true;
      const card = stack.querySelector('.card.active');
      if(card){
        card.style.transition = 'none';
        card.setPointerCapture(e.pointerId);
      }
    }
    if(!swipeLocked) return;

    deltaX = dx;
    const card = stack.querySelector('.card.active');
    if(!card) return;
    const progress = Math.min(Math.abs(deltaX) / (window.innerWidth * 0.45), 1);
    const opacity = 1 - progress * 0.4;
    card.style.transform = `translateX(${deltaX}px)`;
    card.style.opacity = opacity;
    e.preventDefault();
  }
  function onPointerUp(e){
    if(!isDragging || e.pointerId !== activePointerId) return;
    isDragging = false;
    activePointerId = null;
    if(!swipeLocked) return;
    const card = stack.querySelector('.card.active');
    if(!card) return;
    if(Math.abs(deltaX) > swipeThreshold()){
      // Clear inline styles — navigate handles animation via CSS classes
      card.style.transform = '';
      card.style.opacity = '';
      card.style.transition = '';
      navigate(deltaX < 0 ? 1 : -1);
    } else {
      // Snap back to center
      isAnimating = true;
      card.style.transition = `transform .4s var(--ease), opacity .3s ease-out`;
      card.style.transform = '';
      card.style.opacity = '';
      setTimeout(() => { isAnimating = false; card.style.transition = ''; }, 420);
    }
  }
  viewport.addEventListener('pointerdown', onPointerDown);
  viewport.addEventListener('pointermove', onPointerMove);
  viewport.addEventListener('pointerup', onPointerUp);
  viewport.addEventListener('pointercancel', onPointerUp);

  // Keyboard
  document.addEventListener('keydown', function(e){
    if(isGrid || isAnimating) return;
    if(e.key === 'ArrowRight') navigate(1);
    else if(e.key === 'ArrowLeft') navigate(-1);
  });

  // Dots
  function buildDots(){
    dotsEl.innerHTML = '';
    for(let i = 0; i < filtered.length; i++){
      const d = document.createElement('span');
      d.className = 'dot' + (i === current ? ' active' : '');
      d.addEventListener('click', () => {
        if(i !== current && !isAnimating){
          isAnimating = true;
          const dir = i > current ? 1 : -1;
          const prevCard = stack.querySelector(`[data-index="${filtered[current]}"]`);
          if(prevCard){
            prevCard.style.transform = '';
            prevCard.style.opacity = '';
            prevCard.style.transition = '';
            prevCard.classList.remove('active');
            prevCard.classList.add(dir > 0 ? 'exit-left' : 'exit-right');
          }
          const nextCard = stack.querySelector(`[data-index="${filtered[i]}"]`);
          if(nextCard){
            nextCard.classList.add(dir > 0 ? 'enter-right' : 'enter-left');
            nextCard.style.transition = 'none';
            nextCard.offsetHeight;
            nextCard.style.transition = '';
            nextCard.classList.remove('enter-left','enter-right');
            nextCard.classList.add('active');
          }
          current = i;
          updateNav();
          setTimeout(() => {
            if(prevCard) prevCard.classList.remove('exit-left','exit-right');
            isAnimating = false;
          }, 600);
        }
      });
      dotsEl.appendChild(d);
    }
  }
  function updateDots(){
    dotsEl.querySelectorAll('.dot').forEach((d,i) => {
      d.classList.toggle('active', i === current);
    });
  }

  // Home — back to editorial (card 0)
  window.goHome = function(){
    if(isGrid) toggleView();
    showCard(0);
  };

  // Grid card expand/collapse
  window.toggleGridCard = function(card){
    card.classList.toggle('expanded');
  };

  // Context toggle
  window.toggleContext = function(btn){
    const ctx = btn.nextElementSibling;
    const open = ctx.classList.toggle('open');
    btn.classList.toggle('open', open);
    btn.querySelector('.ctx-label').textContent = open ? 'Masquer le contexte' : 'Contexte approfondi';
  };

  // Grid view
  window.toggleView = function(){
    isGrid = !isGrid;
    viewport.style.display = isGrid ? 'none' : '';
    cardNav.style.display = isGrid ? 'none' : '';
    gridView.classList.toggle('active', isGrid);
    const vt = document.querySelector('.view-toggle');
    vt.querySelector('.icon-grid').style.display = isGrid ? 'none' : '';
    vt.querySelector('.icon-cards').style.display = isGrid ? '' : 'none';
    const footer = document.querySelector('.edition-footer');
    if(isGrid){
      document.body.style.height = 'auto';
      document.body.style.overflow = 'auto';
      footer.style.display = 'flex';
    } else {
      document.body.style.height = '100dvh';
      document.body.style.overflow = 'hidden';
      footer.style.display = 'none';
    }
  };

  function renderGrid(){
    const cards = gridView.querySelectorAll('.grid-card');
    cards.forEach(c => {
      const idx = parseInt(c.dataset.index);
      c.style.display = filtered.includes(idx) ? '' : 'none';
    });
  }

  // Init
  initTheme();
  showCard(0);
  buildDots();
})();
</script>
</body>
</html>
